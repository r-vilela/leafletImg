<head>
    <script>L_PREFER_CANVAS = true;</script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
      <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
    <script src=" https://cdn.jsdelivr.net/npm/leaflet-image@0.4.0/leaflet-image.min.js "></script>
    
</head>
<body>
    <div style="display: flex; flex-direction: row; gap: 1rem;">
        <div id='map' style="height: 43.75rem; width: 43.75rem; display: flex;" ></div>
        <div id='snapshot' style="height: 43.75rem; width: 43.75rem; display: flex;"></div>
    </div>
    <button onclick=(snapGenerate())>generate</button>
    <script src='../../leaflet-image.js'></script>
    <script>

        // function runPythonScript() {
        //     var pythonScriptPath = "/test.py";
        //     subprocess.run(["python", pythonScriptPath]);
        // }
        var snapshot = document.getElementById('snapshot');
        
        

        var map = L.map('map')
        
        var polygon = L.polygon([
        [-8.8850, -63.9074],
        [-8.8850, -63.9180],
        [-8.8880, -63.9180],
        [-8.8880, -63.9074],
        ]).addTo(map);
        

        // L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        //     attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        // }).addTo(map);
        L.tileLayer('https://geoportal.sedam.ro.gov.br/mosaicos/sentinel/072024/{z}/{x}/{y}.png', {}).addTo(map)
            
        
        // map.setView([-8.885071663468993, -63.9077], 17);

        map.fitBounds(polygon.getBounds());
        
            leafletImage(map, function (err, canvas) {
         

            const pixel = map.latLngToContainerPoint([-8.8850, -63.9074]) 

            const pixel2 = map.latLngToContainerPoint([-8.8850, -63.9180]) 

            const pixel3 = map.latLngToContainerPoint([-8.8880, -63.9180]) 

            const pixel4 = map.latLngToContainerPoint([-8.8880, -63.9074]) 
         
            const ctx = canvas.getContext("2d");

            
            ctx.fillStyle = "rgb(51, 136, 255, 20%)";
            

            ctx.beginPath();
            ctx.moveTo(pixel.x, pixel.y);
            ctx.lineTo(pixel2.x, pixel2.y);
            ctx.lineTo(pixel3.x, pixel3.y);
            ctx.lineTo(pixel4.x, pixel4.y);
            ctx.fill();

            ctx.strokeStyle = "rgb(51, 136, 255)";

            ctx.lineWidth = 3
            ctx.beginPath();
            ctx.moveTo(pixel.x, pixel.y);
            ctx.lineTo(pixel2.x, pixel2.y);
            ctx.lineTo(pixel3.x, pixel3.y);
            ctx.lineTo(pixel4.x, pixel4.y);
            ctx.lineTo(pixel.x, pixel.y);
            ctx.stroke();

            var img = document.createElement('img');
            var dimensions = map.getSize();
            img.width = dimensions.x;
            img.height = dimensions.y;
            img.src = canvas.toDataURL();
            snapshot.innerHTML = '';
            snapshot.appendChild(img);
        })

        
    </script>
</body>
</html>